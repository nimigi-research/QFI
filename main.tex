% =====================================================================
% The Quotient Flow Invariant (QFI): Idiom-Portable Inference via
% Spectral–LDP Geometry, Drift-Valid Coverage, and Murphy Scheduling
% =====================================================================
\documentclass[11pt]{article}

% -------------------- Encoding & Geometry --------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[margin=1in]{geometry}

% -------------------- Math & Theorems --------------------
\usepackage{amsmath,amssymb,amsthm,mathtools}
\usepackage{bm,bbm}
\usepackage{booktabs}

% -------------------- Hyperrefs & Cleveref --------------------
\usepackage{hyperref}
\usepackage[nameinlink,noabbrev]{cleveref}

% -------------------- Bibliography (biblatex/biber) --------------------
\usepackage[backend=biber,style=authoryear,maxcitenames=2,maxbibnames=9,doi=false,isbn=false,url=false]{biblatex}
\addbibresource{refs.bib} % keep your existing bibliography
% We also embed a small auxiliary .bib so this file compiles standalone.
\begin{filecontents*}{refs_added.bib}
@unpublished{elliott2025qfi,
  title   = {The Quotient Flow Invariant},
  author  = {Elliott, Jacob Alexander},
  note    = {Manuscript},
  year    = {2025}
}
@unpublished{elliott2025idiom,
  title   = {Idiom Projections on Finite Paths and Fisher–Information Transport},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025drift,
  title   = {Ergodic Metric Drift as a Path–Validity Engine: Finite Graphs},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025ki,
  title   = {Kantian Inevitability: Canonical Forms Under Shared Constraints (KI-{\Delta}2)},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025flow,
  title   = {Measure-Theoretic Flow Centrality},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025contracts,
  title   = {Measure-Theoretic Compile-Time Safety Contracts for Decision Kernels},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025graded,
  title   = {A Typed, Contract-Indexed, Graded Effect Calculus for Safe Composition},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@unpublished{elliott2025pmb,
  title   = {Parallel Murphy Budgeting for Experimental Design},
  author  = {Elliott, Jacob Alexander},
  year    = {2025},
  note    = {Manuscript}
}
@book{CoverThomas2006,
  author = {Cover, Thomas M. and Thomas, Joy A.},
  title  = {Elements of Information Theory},
  edition= {2},
  year   = {2006},
  publisher = {Wiley}
}
@book{AmariNagaoka2000,
  author = {Amari, Shun-ichi and Nagaoka, Hiroshi},
  title  = {Methods of Information Geometry},
  year   = {2000},
  publisher = {American Mathematical Society}
}
@book{Cencov1982,
  author = {Cencov, N. N.},
  title  = {Statistical Decision Rules and Optimal Inference},
  year   = {1982},
  publisher = {American Mathematical Society}
}
@article{Blackwell1953,
  author = {Blackwell, David},
  title  = {Equivalent Comparisons of Experiments},
  journal= {The Annals of Mathematical Statistics},
  year   = {1953},
  volume = {24},
  number = {2},
  pages  = {265--272}
}
@book{MeynTweedie2009,
  author = {Meyn, Sean P. and Tweedie, Richard L.},
  title  = {Markov Chains and Stochastic Stability},
  edition = {2},
  year   = {2009},
  publisher = {Cambridge University Press}
}
@book{DemboZeitouni1998,
  author = {Dembo, Amir and Zeitouni, Ofer},
  title  = {Large Deviations Techniques and Applications},
  edition= {2},
  year   = {1998},
  publisher = {Springer}
}
@book{Villani2009,
  author = {Villani, C{\'e}dric},
  title  = {Optimal Transport: Old and New},
  year   = {2009},
  publisher = {Springer}
}
@article{KochenStone1964,
  author  = {Kochen, Simon and Stone, Charles J.},
  title   = {A Note on the Borel--Cantelli Lemma},
  journal = {Illinois Journal of Mathematics},
  year    = {1964},
  volume  = {8},
  number  = {2},
  pages   = {248--251}
}
@article{Freedman1975,
  author = {Freedman, David A.},
  title  = {On Tail Probabilities for Martingales},
  journal= {The Annals of Probability},
  year   = {1975},
  volume = {3},
  number = {1},
  pages  = {100--118}
}
\end{filecontents*}
\addbibresource{refs_added.bib}

% -------------------- Environments & Macros --------------------
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\newcommand{\E}{\mathbb{E}}
\newcommand{\Prob}{\mathbb{P}}
\newcommand{\1}{\mathbbm{1}}
\newcommand{\KL}{\mathrm{KL}}
\newcommand{\TV}{\mathrm{TV}}
\newcommand{\Wone}{W_1}

\title{The Quotient Flow Invariant (QFI):\\
Idiom-Portable Inference via Spectral--LDP Geometry, Drift-Valid Coverage, and Murphy Scheduling}
\author{}
\date{August 16, 2025}

% =====================================================================
\begin{document}
\maketitle

\begin{abstract}
We formalize the \emph{Quotient Flow Invariant} (QFI): an invariant of inference that persists under idiom changes (set-theoretic, categorical, graph/quotient), respects sufficiency, and is stable under coarse-graining and drift. On finite quotients we derive a spectral--tilt representation of budgeted reachability and occupancy, identify Level--2.5 large deviations for empirical flows and their contraction to transitions, and prove gap-damped stability bounds under lumpability error. QFI interlocks with (i) Fisher-information transport and CRLB monotonicity under sufficient/coarse-graining kernels \parencite{elliott2025idiom,CoverThomas2006,AmariNagaoka2000,Cencov1982,Blackwell1953}, (ii) an ergodic drift-validity engine that guarantees infinitely-often path validity under small-ball hypotheses, weak dependence, and Markov regeneration \parencite{elliott2025drift,KochenStone1964,Freedman1975,MeynTweedie2009}, (iii) measure-theoretic flow centrality as the graph geometry of inference routes \parencite{elliott2025flow}, and (iv) Murphy-optimal experimental scheduling that compresses latency to canonical observations \parencite{elliott2025pmb}. The resulting instrumentation is exactly the stack used in \emph{Kantian Inevitability (KI-\(\Delta\)2)} for phase mapping and implementation-agnostic canonicals \parencite{elliott2025ki}.
\end{abstract}

\section{Introduction}
QFI captures what \emph{survives} across idioms: when models are compiled between set-theoretic kernels, categorical probabilities, and finite quotient flows, certain spectral and information-geometric quantities commute with the translation and remain operationally identical. This paper completes the computational backbone alluded to in \parencite{elliott2025qfi} by (i) making the spectral machinery explicit on quotients, (ii) tying it to FI-transport and the CRLB via \parencite{elliott2025idiom}, (iii) coupling it to drift-validity \parencite{elliott2025drift}, and (iv) wiring it to Murphy budgeting \parencite{elliott2025pmb} and Flow Centrality \parencite{elliott2025flow}. The KI program leverages these tools to build a falsifiable phase map over constraints \parencite{elliott2025ki}.

\paragraph{Contributions.}
\begin{enumerate}
  \item \textbf{Invariant schema.} We formalize QFI at the quotient level: invariance to measurable isomorphisms; monotonicity under partition refinement; stability under lumpability error.
  \item \textbf{Spectral--LDP layer.} A Feynman--Kac tilt yields \(\log\rho(t)\) as the CGF for occupancy; the Legendre dual gives rate functions, providing Murphy horizons via explicit \(I(\theta)\) curves \parencite{DemboZeitouni1998}.
  \item \textbf{Stability.} Gap-damped bounds control the effect of aggregation error on powers, stationary laws, and rate functions.
  \item \textbf{Interoperability.} FI transport/data processing \parencite{elliott2025idiom} and drift-validity \parencite{elliott2025drift} integrate into a single scheduling and alarm system for inference.
\end{enumerate}

\section{Setup: idioms, aggregation, and the quotient object}
Let \((U,\mathcal{F},\mu)\) be a standard Borel space and \(K:U\rightsquigarrow U\) a Markov kernel. Let \(\Pi=\{A_1,\dots,A_m\}\) be a measurable partition with \(\mu(A_i)>0\). Aggregation produces a row-stochastic matrix \(P\in\mathbb{R}^{m\times m}\) via
\begin{equation}
  p_{ij}\;=\;\E_{x\sim \mu(\cdot\,|\,A_i)}\big[K(x,A_j)\big],\qquad \sum_j p_{ij}=1,\;p_{ij}\ge 0.
  \label{eq:aggregation}
\end{equation}
This is the finite \emph{quotient flow} on which we compute QFI quantities. The categorical and set-theoretic idioms compile to the same quotient object (via Giry/Markov categories and conditional expectation), and QFI is defined on \((\Pi,P)\) regardless of idiom choice.

\begin{definition}[QFI schema]
A real-valued functional \(J\) on paths or on \((\Pi,P)\) is a \emph{Quotient Flow Invariant} if it satisfies:
\begin{enumerate}
  \item \textbf{Isomorphism invariance.} \(J\) is unchanged under measurable isomorphisms of \(U\) and under state relabelings of \(\Pi\).
  \item \textbf{Monotonicity under refinement.} If \(\Pi'\) refines \(\Pi\) then \(J(\Pi',P')\ge J(\Pi,P)\) (or the appropriate order for a cost).
  \item \textbf{Stability under lumpability error.} If the dispersion of conditional kernels inside each \(A_i\) is bounded by \(\varepsilon_{\mathrm{lump}}\), then the deviation of \(J\) between aggregated and true dynamics is \(O(\varepsilon_{\mathrm{lump}}/\gamma)\), where \(\gamma\) is the spectral gap of \(P\).
\end{enumerate}
\end{definition}

These properties are precisely what make the stack idiom-portable and robust under coarse-graining; they are the finite, operational reflection of the sufficiency principles in \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982} and of the contraction/invariance structure used in KI \parencite{elliott2025ki}.

\section{Spectral tilt, occupancy CGF, and Murphy horizons}\label{sec:spectral}
Fix \(S\subseteq[m]\). Define the \emph{tilted operator}
\begin{equation}
  T(t)\;=\;\mathrm{diag}\big(e^{t\cdot \1_S}\big)\,P,\qquad \Lambda(t):=\log\rho\!\left(T(t)\right),
\end{equation}
with \(\rho(\cdot)\) the spectral radius. Then \(\Lambda\) is the cumulant generating function for the empirical occupancy \(\hat\theta_L=\frac{1}{L}\sum_{t=0}^{L-1}\1\{X_t\in S\}\), and the \emph{rate function}
\begin{equation}
  I_S(\theta)\;=\;\sup_{t\in\mathbb{R}}\;\{\,t\theta-\Lambda(t)\,\}
\end{equation}
governs large deviations of \(\hat\theta_L\) \parencite{DemboZeitouni1998}. This yields Murphy-style budget horizons.

\begin{theorem}[Occupancy LDP and critical horizons]\label{thm:ldp}
For an irreducible, aperiodic \(P\), \(\hat\theta_L\) satisfies an LDP with good, convex rate \(I_S\). Given information price \(\alpha>0\) and failure probability \(\beta\in(0,1)\), the \emph{critical horizon}
\begin{equation}
  L_c(S,\theta;\alpha,\beta)\;\approx\;\frac{\log(1/\beta)}{\alpha\,I_S(\theta)}
\end{equation}
achieves \(\Prob[\hat\theta_L\ge\theta]\ge 1-\beta\) up to standard prefactors.
\end{theorem}

This spectral layer underlies the \emph{Murphy plots} used to schedule discovery: we sweep \(\theta\) and report \(L_c\), selecting \(S\) along flow-central bottlenecks \parencite{elliott2025flow,elliott2025pmb}.

\section{Level–2.5 flows and contraction to transitions}\label{sec:twofive}
Let \(F(L)\) be empirical edge flows and \(Q(L)\) the empirical transition matrix. On the balanced-flow polytope,
\begin{equation}
  I(F)\;=\;\sum_{i,j} F_{ij}\log\frac{F_{ij}}{\eta_i p_{ij}},\qquad
  I(Q)\;=\;\sum_{i}\eta_i\,\KL\!\big(Q_i\;\|\;P_i\big),
\end{equation}
with \(\eta\) the stationary law of \(P\). This is the Level–2.5/Level–2 structure exploited by Flow Centrality and absorbed into QFI for computable bounds and schedule design \parencite{elliott2025flow}.

\section{Stability under lumpability: gap-damped bounds}\label{sec:stability}
Let \(\varepsilon_{\mathrm{lump}}\) bound the within-cell dispersion of conditional transitions. Write \(\tilde P\) for an idealized exact-lumpable quotient and \(P\) for the empirical aggregate.

\begin{proposition}[Gap-damped stability]
There exists a universal constant \(C\) such that, for any power \(t\ge 1\),
\begin{equation}
  \|P^t-\tilde P^{\,t}\|_{\infty}\;\le\;C\,\frac{\varepsilon_{\mathrm{lump}}}{\gamma},\qquad
  |\Lambda_P(t)-\Lambda_{\tilde P}(t)|\;\le\;C\,\frac{\varepsilon_{\mathrm{lump}}}{\gamma},
\end{equation}
with \(\gamma\) the spectral gap of \(P\) (or its multiplicative symmetrization). Consequently, stationary laws, occupancy rates \(I_S\), and Murphy horizons are stable with the same modulus.
\end{proposition}

\noindent\emph{Idea.} Spectral perturbation bounds and reversibilization control the movement of \(\rho(\cdot)\) and eigenvectors under bounded row perturbations; errors across powers are dominated by the second eigenvalue, yielding the \(\varepsilon_{\mathrm{lump}}/\gamma\) damping.

\section{Action–Betweenness as a QFI instance}\label{sec:ab}
Define the price–\(\alpha\) \emph{action–betweenness} at node \(k\):
\begin{equation}
  \mathrm{AB}_\alpha(k)\;:=\;\sum_{i\neq k\neq j} w_{ij}\Big(J^\star(i\!\to\!j;\alpha)-J^\star(i\!\to\!j\,|\,\mathrm{avoid}\;k;\alpha)\Big)_+,
\end{equation}
where \(J^\star\) is the optimal tilted cost derived from \(\Lambda\). Then \(\mathrm{AB}_\alpha\) is invariant under isomorphisms, monotone under refinement, and stable under lumpability with the same modulus—hence a QFI.

\section{Interoperability with FI transport and the modal shell}\label{sec:interop}
On finite path spaces, FI transports exactly under sufficient statistics and contracts under coarse-graining kernels; CRLB bounds degrade monotonically \parencite{elliott2025idiom,CoverThomas2006,AmariNagaoka2000}. This aligns spectral–LDP diagnostics with information geometry: sufficiency equalities mark where \(\Lambda\) and \(I_S\) coincide across idioms, while strict contraction flags irrecoverable information loss. The modal shell’s necessity operators are preserved under p-morphisms, and declarative properties lift through the quotient provided kernels satisfy compile-time contracts \parencite{elliott2025ki,elliott2025contracts,elliott2025graded}.

\section{Coupling to drift-validity and regeneration}\label{sec:drift}
Under metric/cost drift, the drift-validity engine guarantees that every finite path attains budgeted validity infinitely often almost surely, with routes beyond independence: Kochen–Stone for weak dependence and regeneration for Harris chains \parencite{elliott2025drift,KochenStone1964,Freedman1975,MeynTweedie2009}. Finite-family coverage admits coupon-collector bounds and latency estimates; these parameters plug directly into Murphy horizons at the quotient, tightening schedule guarantees.

\section{Murphy-optimal budgeting}\label{sec:murphy}
Given price \(\alpha\) and failure \(\beta\), we allocate budget to minimize the worst-case \(L_c\) over targets \(S\) along high centrality. The hazard-style index reduces to slopes of \(\Lambda\) at operating points, recovering the practical rules in \parencite{elliott2025pmb} and the instrumentation used in KI \parencite{elliott2025ki}.

\section{Typed effects and compile-time contracts}\label{sec:types}
Inference programs carry effect types indexed by budgets \((b,K,H,\sigma,\alpha)\) and graded by information usage and risk; composition preserves grades and invariants, preventing semantic leakage across idioms \parencite{elliott2025graded,elliott2025contracts}. QFI quantities are thus \emph{typed invariants}: their definability and stability are enforced statically, while their discovery is scheduled dynamically.

\section{A toy example: three-node Exp\((\theta)\) graph}\label{sec:toy}
Let a 3-node line have i.i.d.\ edge weights with \(\mathrm{Exp}(\theta)\) laws per epoch. For a 2-edge path \(p\), small-ball probabilities scale like \(B^2\) at budget \(B\), giving a positive USB constant and hence EC for \(p\) \parencite{elliott2025drift}. Aggregating over the partition \(\Pi\) that merges the two interior states yields \(P\) with an explicit \(\Lambda\) curve; the Murphy horizon for hitting the merged target cell at occupancy \(\theta\) follows from \Cref{thm:ldp}. Avoiding the interior node inflates \(J^\star\) and produces a positive \(\mathrm{AB}_\alpha\) spike, visible in Flow Centrality plots \parencite{elliott2025flow}.

\section{Discussion: limits and diagnostics}
QFI degrades when (i) lumpability error dominates the spectral gap; (ii) FI transport is strictly contracting in every idiom; (iii) drift breaks small-ball floors. These conditions are detectable by the same stack: curvature spikes (FI), rerouting (Flow Centrality), continuity residuals (OT/Wasserstein diagnostics), and drift alarms \parencite{elliott2025ki,elliott2025flow,elliott2025drift,Villani2009}.

\section{Implementation notes}
A small Mathematica toolkit computes \(\rho(t)\), \(I_S(\theta)\), \(L_c\), and \(\mathrm{AB}_\alpha\) on any \(P\); these scripts generate Murphy plots and centrality overlays used across the manuscripts. Lean stubs formalize aggregation as row-stochastic and can be extended toward lumpability stability. (These artifacts are optional and do not alter the theory.)

\section*{Acknowledgments}
This unified, monolithic presentation replaces supplemental sketches by absorbing spectral, LDP, stability, and scheduling details into the mainline development. It is designed to be idiom-agnostic and drop-in compatible with the KI/Flow/Contracts ecosystem.

\printbibliography

\end{document}